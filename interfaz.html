<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Parque Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .light-intensity {
            transition: height 0.5s ease;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="gradient-bg text-white p-6 shadow-lg">
            <div class="container mx-auto flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">🌳 Parque Inteligente IoT</h1>
                    <p class="text-gray-300">Sistema de monitoreo en tiempo real</p>
                </div>
                <button id="themeToggle" class="bg-white text-gray-800 px-4 py-2 rounded-full flex items-center">
                    <i class="fas fa-moon mr-2"></i> Modo Oscuro
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto p-6">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Status Panel -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 col-span-1">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i> Estado del Sistema
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span>Sensor PIR:</span>
                            <span id="pirStatus" class="px-3 py-1 rounded-full bg-red-500 text-white">Inactivo</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span>Intensidad de Luz:</span>
                            <div class="flex items-center">
                                <div class="w-24 h-2 bg-gray-200 dark:bg-gray-600 rounded-full mr-2">
                                    <div id="lightBar" class="h-full bg-yellow-400 rounded-full" style="width: 30%"></div>
                                </div>
                                <span id="lightPercent">30%</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span>Conexión WiFi:</span>
                            <span class="px-3 py-1 rounded-full bg-green-500 text-white">Conectado</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <span>Estado Blynk:</span>
                            <span class="px-3 py-1 rounded-full bg-green-500 text-white">Activo</span>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="font-medium mb-2">Visualización de Luz</h3>
                        <div class="bg-gray-200 dark:bg-gray-700 rounded-lg p-4 flex justify-center">
                            <div id="lightVisual" class="w-16 h-16 rounded-full bg-yellow-200 shadow-lg flex items-center justify-center">
                                <div id="lightCore" class="w-8 h-8 rounded-full bg-yellow-400"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Activity Panel -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 col-span-2">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-green-500"></i> Actividad Reciente
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Motion Graph -->
                        <div>
                            <h3 class="font-medium mb-2">Detección de Movimiento</h3>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
                                <canvas id="motionChart" height="200"></canvas>
                            </div>
                        </div>
                        
                        <!-- Light Graph -->
                        <div>
                            <h3 class="font-medium mb-2">Intensidad de Luz</h3>
                            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
                                <canvas id="lightChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="mt-6">
                        <h3 class="font-medium mb-2">Historial de Notificaciones</h3>
                        <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4 max-h-60 overflow-y-auto">
                            <div id="notificationList">
                                <div class="p-3 border-b border-gray-200 dark:border-gray-600">
                                    <div class="flex justify-between">
                                        <span class="font-medium">Nueva detección</span>
                                        <span class="text-sm text-gray-500">Hace 2 minutos</span>
                                    </div>
                                    <p class="text-sm mt-1">Movimiento detectado en la zona norte del parque</p>
                                </div>
                                <div class="p-3 border-b border-gray-200 dark:border-gray-600">
                                    <div class="flex justify-between">
                                        <span class="font-medium">Luz atenuada</span>
                                        <span class="text-sm text-gray-500">Hace 5 minutos</span>
                                    </div>
                                    <p class="text-sm mt-1">No se detectó movimiento por 10 segundos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Park Map -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 col-span-3">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-map-marked-alt mr-2 text-purple-500"></i> Mapa del Parque
                    </h2>
                    
                    <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-4">
                        <div class="relative h-64 md:h-80 bg-green-100 dark:bg-green-900 rounded-lg">
                            <!-- Park elements -->
                            <div class="absolute top-1/4 left-1/4 w-16 h-16 rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center">
                                <i class="fas fa-tree text-green-600 dark:text-green-300"></i>
                            </div>
                            <div class="absolute top-1/3 right-1/3 w-16 h-16 rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center">
                                <i class="fas fa-tree text-green-600 dark:text-green-300"></i>
                            </div>
                            <div class="absolute bottom-1/4 right-1/4 w-16 h-16 rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center">
                                <i class="fas fa-tree text-green-600 dark:text-green-300"></i>
                            </div>
                            
                            <!-- Path -->
                            <div class="absolute top-1/2 left-0 right-0 h-2 bg-gray-400 dark:bg-gray-500"></div>
                            
                            <!-- Sensor/Light -->
                            <div id="sensorLocation" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-red-500 flex items-center justify-center text-white">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            
                            <!-- Person indicator -->
                            <div id="personIndicator" class="absolute hidden top-1/3 left-1/3 w-8 h-8 rounded-full bg-yellow-400 flex items-center justify-center">
                                <i class="fas fa-person text-white text-xs"></i>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex justify-center space-x-4">
                            <button id="simulateMotion" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                                <i class="fas fa-running mr-2"></i> Simular Movimiento
                            </button>
                            <button id="resetSimulation" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-redo mr-2"></i> Reiniciar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                themeToggle.innerHTML = '<i class="fas fa-sun mr-2"></i> Modo Claro';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon mr-2"></i> Modo Oscuro';
            }
        });

        // Initialize charts
        const motionCtx = document.getElementById('motionChart').getContext('2d');
        const lightCtx = document.getElementById('lightChart').getContext('2d');
        
        const motionChart = new Chart(motionCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 20}, (_, i) => i + 1),
                datasets: [{
                    label: 'Detección de Movimiento',
                    data: Array(20).fill(0),
                    borderColor: 'rgb(239, 68, 68)',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 1,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
        
        const lightChart = new Chart(lightCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 20}, (_, i) => i + 1),
                datasets: [{
                    label: 'Intensidad de Luz (%)',
                    data: Array(20).fill(30),
                    borderColor: 'rgb(234, 179, 8)',
                    backgroundColor: 'rgba(234, 179, 8, 0.1)',
                    tension: 0.1,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                }
            }
        });

        // Simulation functions
        let motionTimeout;
        const simulateMotion = document.getElementById('simulateMotion');
        const resetSimulation = document.getElementById('resetSimulation');
        const pirStatus = document.getElementById('pirStatus');
        const lightBar = document.getElementById('lightBar');
        const lightPercent = document.getElementById('lightPercent');
        const lightVisual = document.getElementById('lightVisual');
        const lightCore = document.getElementById('lightCore');
        const personIndicator = document.getElementById('personIndicator');
        const notificationList = document.getElementById('notificationList');
        
        simulateMotion.addEventListener('click', () => {
            // Show person indicator
            personIndicator.classList.remove('hidden');
            personIndicator.classList.add('pulse-animation');
            
            // Update PIR status
            pirStatus.textContent = 'Activo';
            pirStatus.className = 'px-3 py-1 rounded-full bg-green-500 text-white';
            
            // Update light to 100%
            lightBar.style.width = '100%';
            lightPercent.textContent = '100%';
            lightVisual.classList.add('pulse-animation');
            lightCore.style.backgroundColor = '#facc15';
            
            // Add data to charts
            addChartData(motionChart, 1);
            addChartData(lightChart, 100);
            
            // Add notification
            const now = new Date();
            const notification = document.createElement('div');
            notification.className = 'p-3 border-b border-gray-200 dark:border-gray-600';
            notification.innerHTML = `
                <div class="flex justify-between">
                    <span class="font-medium">Nueva detección</span>
                    <span class="text-sm text-gray-500">Hace unos segundos</span>
                </div>
                <p class="text-sm mt-1">Movimiento detectado cerca del sensor</p>
            `;
            notificationList.insertBefore(notification, notificationList.firstChild);
            
            // After 10 seconds without motion, dim the lights
            clearTimeout(motionTimeout);
            motionTimeout = setTimeout(() => {
                personIndicator.classList.add('hidden');
                personIndicator.classList.remove('pulse-animation');
                
                pirStatus.textContent = 'Inactivo';
                pirStatus.className = 'px-3 py-1 rounded-full bg-red-500 text-white';
                
                lightBar.style.width = '30%';
                lightPercent.textContent = '30%';
                lightVisual.classList.remove('pulse-animation');
                lightCore.style.backgroundColor = '#fbbf24';
                
                addChartData(motionChart, 0);
                addChartData(lightChart, 30);
                
                const dimNotification = document.createElement('div');
                dimNotification.className = 'p-3 border-b border-gray-200 dark:border-gray-600';
                dimNotification.innerHTML = `
                    <div class="flex justify-between">
                        <span class="font-medium">Luz atenuada</span>
                        <span class="text-sm text-gray-500">Hace unos segundos</span>
                    </div>
                    <p class="text-sm mt-1">No se detectó movimiento por 10 segundos</p>
                `;
                notificationList.insertBefore(dimNotification, notificationList.firstChild);
            }, 10000);
        });
        
        resetSimulation.addEventListener('click', () => {
            clearTimeout(motionTimeout);
            personIndicator.classList.add('hidden');
            personIndicator.classList.remove('pulse-animation');
            
            pirStatus.textContent = 'Inactivo';
            pirStatus.className = 'px-3 py-1 rounded-full bg-red-500 text-white';
            
            lightBar.style.width = '30%';
            lightPercent.textContent = '30%';
            lightVisual.classList.remove('pulse-animation');
            lightCore.style.backgroundColor = '#fbbf24';
            
            // Reset charts
            motionChart.data.datasets[0].data = Array(20).fill(0);
            lightChart.data.datasets[0].data = Array(20).fill(30);
            motionChart.update();
            lightChart.update();
        });
        
        function addChartData(chart, value) {
            chart.data.datasets[0].data.push(value);
            chart.data.datasets[0].data.shift();
            chart.data.labels.push(chart.data.labels.length + 1);
            chart.data.labels.shift();
            chart.update();
        }
        
        // Simulate random motion every 20-40 seconds
        setInterval(() => {
            if (Math.random() > 0.7) {
                simulateMotion.click();
            }
        }, 20000);
    </script>
</body>
</html>

